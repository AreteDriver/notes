# Session Log — 2026-01-28

## VDC Portfolio — CI/CD Hardening + Features

**Project:** vdc-portfolio
**Duration:** ~1 session
**Focus:** CI pipeline improvements, Docker fix, new features

### Work Completed

1. **CI/CD Hardening:**
   - Added pip cache to GitHub Actions (setup-python cache: pip)
   - Consolidated requirements.txt into pyproject.toml (single source of truth)
   - Added ruff format --check to CI pipeline
   - Fixed coverage scope: Streamlit app.py files are not unit-testable, scoped coverage to shared + logistics modules only
   - Added Dependabot for pip and GitHub Actions

2. **Docker Build Fix:**
   - pyproject.toml readme field referenced CLAUDE.md but *.md was in .dockerignore
   - Changed to README.md and added \!README.md exception to .dockerignore
   - Root cause: migrating from requirements.txt to pyproject.toml introduced metadata file dependency

3. **New Features:**
   - Location-based audit filter (from/to location matching)
   - AR HUD concepts doc (future state vision documentation)

### Key Learnings

- **pytest --cov scope matters:** Multiple --cov= flags with --cov-fail-under measures ALL listed paths. Including untestable entry points (Streamlit apps) tanks coverage from 91% to 60%. Scope to business logic modules only.
- **pyproject.toml in Docker:** The readme field is used during pip install metadata generation. If .dockerignore excludes the referenced file, the build fails. Always cross-check .dockerignore against pyproject.toml fields.
- **Single source of truth:** Consolidating deps into pyproject.toml eliminates drift between requirements.txt and pyproject.toml. Use pip install -e .[dev] in CI.

### Error Patterns Discovered

| Error | Fix |
|-------|-----|
| pytest --cov with untestable app entry points | Scope --cov= to testable modules only |
| pyproject.toml readme file excluded by .dockerignore | Use README.md + add \!README.md to .dockerignore |
